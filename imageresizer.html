<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Image Resizer & Cropper</title>
<link rel="stylesheet" href="assets/Orbitron.css">
<style>
/* Your Orbitron/cyber styles here (same as before) */
* { box-sizing: border-box; }
body, html { margin:0; padding:0; height:100%; background:#0f0f20; font-family:"Orbitron","Segoe UI",sans-serif; color:#00fff7; display:flex; justify-content:center; align-items:center; text-align:center;}
.container { background:#111122; border:2px solid #00fff7; border-radius:12px; padding:2.5rem 2rem 3rem; width:400px; box-shadow:0 0 30px #00fff7; display:flex; flex-direction:column; align-items:center;}
h1 { margin-bottom:1.5rem; text-shadow:0 0 12px #00fff7; font-weight:700; letter-spacing:1.5px;}
.file-input-wrapper { position:relative; width:100%; margin-bottom:1.5rem;}
input[type="file"] { opacity:0; width:100%; height:45px; position:absolute; left:0; top:0; cursor:pointer;}
.file-input-label { border:1.5px solid #00fff7; padding:0.8rem 1rem; border-radius:8px; background:#0f0f20; color:#00fff7; font-weight:600; cursor:pointer; display:inline-block; width:100%; text-align:center; box-shadow:0 0 15px #00fff7; transition: background 0.3s, color 0.3s; }
.file-input-label:hover { background:#00fff7; color:#0f0f20; box-shadow:0 0 25px #00fff7; }
button { width:100%; padding:0.75rem 1rem; font-size:1.1rem; background:#00fff7; border:none; color:#0f0f20; font-weight:700; border-radius:8px; cursor:pointer; box-shadow:0 0 20px #00fff7; margin-top:0.5rem;}
button:hover { background:#00c6b6;}
#canvas-container { margin-top:1rem; width:100%; text-align:center; }
canvas { max-width:100%; border:2px solid #00fff7; border-radius:12px; box-shadow:0 0 20px #00fff7; cursor:crosshair;}
</style>
</head>
<body>
<div class="container">
  <h1>Drag-to-Crop Image</h1>

  <div class="file-input-wrapper">
    <label class="file-input-label" for="upload">Upload Image</label>
    <input type="file" id="upload" accept="image/*">
  </div>

  <button id="cropBtn">Crop Selected Area</button>
  <button id="downloadBtn">Download Cropped Image</button>

  <div id="canvas-container">
    <canvas id="canvas"></canvas>
  </div>
</div>

<script>
const upload = document.getElementById("upload");
const canvas = document.getElementById("canvas");
const ctx = canvas.getContext("2d");
const cropBtn = document.getElementById("cropBtn");
const downloadBtn = document.getElementById("downloadBtn");

let img = new Image();
let startX, startY, endX, endY;
let isDragging = false;
let selection = null;

// Load image
upload.addEventListener("change", e => {
  const file = e.target.files[0];
  if(!file) return;
  const reader = new FileReader();
  reader.onload = e => { img.src = e.target.result; }
  reader.readAsDataURL(file);
});

img.onload = () => {
  canvas.width = img.width;
  canvas.height = img.height;
  ctx.drawImage(img,0,0);
}

// Mouse events for drag-to-crop
canvas.addEventListener("mousedown", e => {
  const rect = canvas.getBoundingClientRect();
  startX = e.clientX - rect.left;
  startY = e.clientY - rect.top;
  isDragging = true;
});

canvas.addEventListener("mousemove", e => {
  if(!isDragging) return;
  const rect = canvas.getBoundingClientRect();
  endX = e.clientX - rect.left;
  endY = e.clientY - rect.top;
  redrawCanvas();
  drawSelection();
});

canvas.addEventListener("mouseup", e => {
  isDragging = false;
  selection = { x: Math.min(startX,endX), y: Math.min(startY,endY), w: Math.abs(endX-startX), h: Math.abs(endY-startY) };
});

// Redraw original image
function redrawCanvas(){
  ctx.clearRect(0,0,canvas.width,canvas.height);
  ctx.drawImage(img,0,0);
}

// Draw selection rectangle
function drawSelection(){
  if(!isDragging) return;
  ctx.strokeStyle = "#00fff7";
  ctx.lineWidth = 2;
  ctx.setLineDash([6]);
  ctx.strokeRect(Math.min(startX,endX), Math.min(startY,endY), Math.abs(endX-startX), Math.abs(endY-startY));
  ctx.setLineDash([]);
}

// Crop
cropBtn.addEventListener("click", () => {
  if(!selection) return alert("Drag to select an area first!");
  const {x,y,w,h} = selection;
  const croppedData = ctx.getImageData(x,y,w,h);
  canvas.width = w;
  canvas.height = h;
  ctx.putImageData(croppedData,0,0);
  selection = null;
});

// Download cropped image
downloadBtn.addEventListener("click", () => {
  if(!img.src) return alert("No image to download");

  // Extract original filename
  const file = upload.files[0];
  if(!file) return alert("No image selected");

  const originalName = file.name; // e.g., "mypic.png"
  const dotIndex = originalName.lastIndexOf(".");
  const name = originalName.substring(0, dotIndex); // "mypic"
  const ext = originalName.substring(dotIndex);     // ".png"
  const newName = name + "-resized" + ext;          // "mypic-resized.png"

  const link = document.createElement("a");
  link.download = newName;
  link.href = canvas.toDataURL("image/png");
  link.click();
});

</script>
</body>
</html>
